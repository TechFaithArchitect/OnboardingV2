<template>
  <lightning-card title={cardTitle}>
    <div class="slds-p-around_medium">
      <div class="slds-box slds-box_x-small slds-theme_info slds-m-bottom_small" style="padding: 0.5rem;">
        <div class="slds-media">
          <div class="slds-media__figure">
            <lightning-icon icon-name="utility:info" size="xx-small" alternative-text="Info"></lightning-icon>
          </div>
          <div class="slds-media__body">
            <p class="slds-text-body_small slds-m-bottom_none">
              <strong>Onboarding Requirement Set:</strong> A collection of requirement templates that define what vendors need to complete. 
              <strong>Display Label:</strong> Look for the <strong>Display Label</strong> column - this shows the descriptive name (e.g., "Standard Business Requirements"). 
              If you see an auto-number like "ORS-00000", it means no Display Label has been set yet. 
              <strong>Best Practice:</strong> Always set a descriptive Display Label when creating requirement sets.
            </p>
          </div>
        </div>
      </div>

      <lightning-input
        label="Search Requirement Sets or Templates"
        value={searchText}
        onchange={handleSearchChange}
        placeholder="Type to search..."
        icon-name="utility:search">
      </lightning-input>

      <template if:true={isHierarchyLoading}>
        <div class="slds-align_absolute-center slds-p-around_large">
          <lightning-spinner alternative-text="Loading requirement sets and templates..." size="medium"></lightning-spinner>
        </div>
      </template>

      <template if:false={isHierarchyLoading}>
        <template if:true={requirementSetHierarchy.length}>
          <lightning-tree-grid
            key-field="id"
            data={requirementSetHierarchy}
            columns={requirementSetHierarchyColumns}
            onrowselection={handleRequirementSetHierarchySelectionChange}
            ontoggle={handleRequirementSetHierarchyToggle}
            expanded-rows={expandedRows}
            selected-rows={selectedRows}
            class="slds-m-top_medium requirement-set-tree-grid">
          </lightning-tree-grid>
        </template>
        <template if:false={requirementSetHierarchy.length}>
          <div class="slds-text-align_center slds-p-around_large">
            <p class="slds-text-body_regular">
              <template if:true={searchText}>
                No requirement sets or templates found matching "{searchText}".
              </template>
              <template if:false={searchText}>
                No requirement sets found. Click "Create New Requirement Set" to create one.
              </template>
            </p>
          </div>
        </template>
      </template>

      <template if:true={selectedRequirementSetId}>
        <div class="slds-box slds-theme_success slds-m-top_medium" style="padding: 0.75rem;">
          <p class="slds-text-body_regular slds-text-heading_small">
            <strong>Selected Requirement Set:</strong> {selectedRequirementSetName}
          </p>
        </div>
      </template>

      <div class="slds-m-top_medium">
        <lightning-button 
          variant="neutral" 
          label={createButtonLabel} 
          onclick={toggleCreateForm}
          class="slds-m-bottom_small">
        </lightning-button>
      </div>

      <template if:true={showCreateForm}>
        <div class="slds-box slds-theme_shade slds-m-bottom_small" style="padding: 0.75rem;">
          <lightning-input 
            label="Requirement Set Name" 
            value={newRequirementSetName} 
            onchange={handleNewRequirementSetChange}
            placeholder="e.g., Standard Business Requirements"
            required>
          </lightning-input>

          <lightning-input 
            label="Display Label (Optional)" 
            value={newRequirementSetDisplayLabel} 
            onchange={handleNewRequirementSetDisplayLabelChange}
            placeholder="e.g., Standard Business Requirements"
            class="slds-m-top_small">
          </lightning-input>
          <p class="slds-text-body_small slds-text-color_weak slds-m-left_small slds-m-top_x-small">
            <lightning-icon icon-name="utility:info" size="xx-small" alternative-text="Info"></lightning-icon>
            If left blank, a Display Label will be automatically generated. You can edit it later on the record page.
          </p>

          <div class="slds-text-body_small slds-text-color_weak slds-m-top_x-small">
            <strong>Note:</strong> The requirement set will be created with Status = "Active", Active = true, Version = 1, and linked to the current Vendor Program.
          </div>

          <lightning-button 
            label="Create Requirement Set" 
            onclick={createRequirementSet} 
            variant="brand"
            disabled={nextDisabled}
            class="slds-m-top_small">
          </lightning-button>
        </div>
      </template>

      <!-- Navigation buttons removed - handled by flow engine footer -->
    </div>
  </lightning-card>
</template>

