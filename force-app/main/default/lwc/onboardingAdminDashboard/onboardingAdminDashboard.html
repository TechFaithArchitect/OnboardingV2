<template>
    <lightning-card title="System Health Dashboard" icon-name="utility:dashboard">
        <div class="slds-m-around_medium">
            <!-- Alerts Section -->
            <template if:true={alerts}>
                <template for:each={alerts} for:item="alert">
                    <lightning-alert
                        key={alert.title}
                        variant={alert.type}
                        title={alert.title}
                        icon-name={alert.icon}
                        class="slds-m-bottom_small">
                        {alert.message}
                    </lightning-alert>
                </template>
            </template>

            <!-- Metrics Grid -->
            <div class="slds-grid slds-gutters slds-wrap slds-m-top_medium">
                <!-- Validation Failures -->
                <div class="slds-col slds-size_1-of-3 slds-medium-size_1-of-3 slds-large-size_1-of-4">
                    <div 
                        class="metric-card slds-card slds-card_boundary" 
                        data-metric="validation"
                        onclick={handleMetricClick}
                        style={validationFailuresCardStyle}>
                        <div class="slds-card__body slds-card__body_inner">
                            <div class="slds-text-heading_large">{metrics.validationFailures24h}</div>
                            <div class="slds-text-body_small slds-m-top_x-small">Validation Failures (24h)</div>
                            <template if:true={metrics.validationFailuresTrend}>
                                <div class="slds-m-top_x-small">
                                    <lightning-icon 
                                        icon-name={validationTrendIcon} 
                                        size="x-small"
                                        alternative-text="Trend">
                                    </lightning-icon>
                                    <span class="slds-m-left_x-small">{metrics.validationFailuresTrend}</span>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Message Failures -->
                <div class="slds-col slds-size_1-of-3 slds-medium-size_1-of-3 slds-large-size_1-of-4">
                    <div 
                        class="metric-card slds-card slds-card_boundary" 
                        data-metric="message"
                        onclick={handleMetricClick}
                        style={messageFailuresCardStyle}>
                        <div class="slds-card__body slds-card__body_inner">
                            <div class="slds-text-heading_large">{metrics.messageFailures24h}</div>
                            <div class="slds-text-body_small slds-m-top_x-small">Message Failures (24h)</div>
                            <template if:true={metrics.messageFailuresTrend}>
                                <div class="slds-m-top_x-small">
                                    <lightning-icon 
                                        icon-name={messageTrendIcon} 
                                        size="x-small"
                                        alternative-text="Trend">
                                    </lightning-icon>
                                    <span class="slds-m-left_x-small">{metrics.messageFailuresTrend}</span>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Webhook Failures -->
                <div class="slds-col slds-size_1-of-3 slds-medium-size_1-of-3 slds-large-size_1-of-4">
                    <div 
                        class="metric-card slds-card slds-card_boundary" 
                        data-metric="webhook"
                        onclick={handleMetricClick}
                        style={webhookFailuresCardStyle}>
                        <div class="slds-card__body slds-card__body_inner">
                            <div class="slds-text-heading_large">{metrics.webhookFailures24h}</div>
                            <div class="slds-text-body_small slds-m-top_x-small">Webhook Failures (24h)</div>
                            <template if:true={metrics.webhookFailuresTrend}>
                                <div class="slds-m-top_x-small">
                                    <lightning-icon 
                                        icon-name={webhookTrendIcon} 
                                        size="x-small"
                                        alternative-text="Trend">
                                    </lightning-icon>
                                    <span class="slds-m-left_x-small">{metrics.webhookFailuresTrend}</span>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Platform Event Volume -->
                <div class="slds-col slds-size_1-of-3 slds-medium-size_1-of-3 slds-large-size_1-of-4">
                    <div 
                        class="metric-card slds-card slds-card_boundary" 
                        style={platformEventCardStyle}>
                        <div class="slds-card__body slds-card__body_inner">
                            <div class="slds-text-heading_large">{metrics.platformEventVolume1h}</div>
                            <div class="slds-text-body_small slds-m-top_x-small">Platform Events (1h)</div>
                            <div class="slds-text-body_small slds-m-top_x-small slds-text-color_weak">Threshold: 1,500</div>
                        </div>
                    </div>
                </div>

                <!-- Active Follow-Up Queues -->
                <div class="slds-col slds-size_1-of-3 slds-medium-size_1-of-3 slds-large-size_1-of-4">
                    <div 
                        class="metric-card slds-card slds-card_boundary" 
                        data-metric="message"
                        onclick={handleMetricClick}>
                        <div class="slds-card__body slds-card__body_inner">
                            <div class="slds-text-heading_large">{metrics.activeFollowUpQueues}</div>
                            <div class="slds-text-body_small slds-m-top_x-small">Active Follow-Up Queues</div>
                        </div>
                    </div>
                </div>

                <!-- Override Operations -->
                <div class="slds-col slds-size_1-of-3 slds-medium-size_1-of-3 slds-large-size_1-of-4">
                    <div 
                        class="metric-card slds-card slds-card_boundary" 
                        data-metric="override"
                        onclick={handleMetricClick}>
                        <div class="slds-card__body slds-card__body_inner">
                            <div class="slds-text-heading_large">{metrics.overrideOperations7d}</div>
                            <div class="slds-text-body_small slds-m-top_x-small">Override Operations (7d)</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading Spinner -->
            <template if:true={isLoading}>
                <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
            </template>

            <!-- Validation Rule Builder Section -->
            <div class="slds-m-top_large">
                <h2 class="slds-text-heading_small slds-m-bottom_small">Validation Rule Builder</h2>
                <lightning-layout multiple-rows class="slds-border_bottom slds-p-bottom_small slds-m-bottom_small">
                    <lightning-layout-item size="12">
                        <c-requirement-rule-builder></c-requirement-rule-builder>
                    </lightning-layout-item>
                </lightning-layout>
            </div>

            <!-- Validation Failures List -->
            <div class="slds-m-top_large">
                <h2 class="slds-text-heading_small slds-m-bottom_small">Recent Validation Failures</h2>
                <c-validation-failures-panel></c-validation-failures-panel>
            </div>

            <!-- Messaging Issues -->
            <div class="slds-m-top_large">
                <h2 class="slds-text-heading_small slds-m-bottom_small">Messaging Issues</h2>
                <c-messaging-issues-panel></c-messaging-issues-panel>
            </div>

            <!-- Validation Rule Tester -->
            <div class="slds-m-top_large">
                <h2 class="slds-text-heading_small slds-m-bottom_small">Validation Rule Tester</h2>
                <c-validation-rule-tester></c-validation-rule-tester>
            </div>

            <!-- Override Audit -->
            <div class="slds-m-top_large">
                <h2 class="slds-text-heading_small slds-m-bottom_small">Override Audit</h2>
                <c-override-audit-panel></c-override-audit-panel>
            </div>
        </div>
    </lightning-card>
</template>
