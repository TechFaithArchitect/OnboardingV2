<apex:page showHeader="false" sidebar="false" >
<html lang="en">
<head>
    <meta charset="UTF-8"></meta>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"></meta>
    <title>SCANNER APP</title>
</head>
<body>
    <apex:includeScript value="{!$Resource.barcodescanner}"/>
    <div style="text-align: center;">

        <div id="reader" style="width: 100%;height=100%"></div>
        <div id="show" style="display: none;padding: 70px 0; text-align: center; font-size: 25px;  margin-top: 50px;">
            <h4 style="color: Black;">Scanned Result</h4>
            <p style="color: blue;" id="result"></p>
        </div>
    </div>
    <script>
        const lexOrigin = '{!IF(ISBLANK($User.ContactId), JSENCODE($Setup.FSL_Settings__c.Internal_Site_URL__c), JSENCODE($Setup.FSL_Settings__c.Community_Site_URL__c))}';
        let scanSuccess = false;

        const readerElement = document.getElementById('reader');
        const scannerWidth = readerElement.offsetWidth - 1; // Make qrbox work by setting it's width slightly smaller than the element
        const scannerHeight = Math.round(scannerWidth * (75/275)); // Maintain aspect ratio of bar code

        let html5QrcodeScanner = new Html5QrcodeScanner(
            "reader", { fps: 10, qrbox: { width: scannerWidth, height: scannerHeight }, rememberLastUsedCamera: true, supportedScanTypes: [Html5QrcodeScanType.SCAN_TYPE_CAMERA] });
        html5QrcodeScanner.render(onScanSuccess);


        function onScanSuccess(decodedText, decodedResult) {
            if (scanSuccess) {
                return;
            }
            scanSuccess = true;
            console.log(`Code scanned = ${decodedText}`, decodedResult);
            document.getElementById('show').style.display = 'block';
            document.getElementById('reader').style.display = 'none';
            document.getElementById('result').textContent = decodedText;
            var message = {
                name: "VFToLWCMessage",
                payload: decodedText
            };
            parent.postMessage(message, lexOrigin);
        }
    </script>
    
</body>
</html>
</apex:page>