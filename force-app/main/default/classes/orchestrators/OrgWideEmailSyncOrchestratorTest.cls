@isTest
private class OrgWideEmailSyncOrchestratorTest {

    @isTest
    static void testRunFullSync_success() {
        // MOCK DATA SETUP
        OrgWideEmailDTO orgWideEmailDTO = new OrgWideEmailDTO();
        orgWideEmailDTO.developerName = 'mock_dev';
        orgWideEmailDTO.emailAddress = 'test@example.com';
        orgWideEmailDTO.masterLabel = 'Test Sender';
        orgWideEmailDTO.isActive = true;

        OrgWideEmailSyncService.setMockDtos(new List<OrgWideEmailDTO>{ orgWideEmailDTO });

        // MOCK CMDT (using actual metadata type name)
        OrgWideEmailCMDTRepository.setMockCatalogs(new Map<String, Org_Wide_Email__mdt>());

        Test.startTest();
        OrgWideEmailSyncOrchestrator.runFullSync(true);
        Test.stopTest();

        // VERIFY SUCCESS LOG
        Sync_Log__c syncLog = [SELECT Id, Status__c FROM Sync_Log__c LIMIT 1];
        System.assertEquals('Success', syncLog.Status__c, 'Log should indicate success');
    }

    @isTest
    static void testRunFullSync_failure() {
        // ðŸ’£ Simulate failure with invalid data
        OrgWideEmailDTO orgWideEmailDTO = new OrgWideEmailDTO();
        orgWideEmailDTO.developerName = null; // Null dev name will cause DML error

        OrgWideEmailSyncService.setMockDtos(new List<OrgWideEmailDTO>{ orgWideEmailDTO });

        Test.startTest();
        OrgWideEmailSyncOrchestrator.runFullSync(false);
        Test.stopTest();

        // âœ… Verify failure log
        Sync_Log__c syncLog = [SELECT Id, Status__c, Error_Message__c FROM Sync_Log__c LIMIT 1];
        System.assertEquals('Failed', syncLog.Status__c, 'Log should indicate failure');
        System.assertNotEquals(null, syncLog.Error_Message__c, 'Error message should be recorded');
    }
}