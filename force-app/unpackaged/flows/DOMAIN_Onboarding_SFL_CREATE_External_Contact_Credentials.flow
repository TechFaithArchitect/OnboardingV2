<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>64.0</apiVersion>
    <assignments>
        <name>Assign_ECC_Credential_Type_to_RequireECCTypeIdCollection</name>
        <label>Assign ECC Credential Type to RequireECCTypeIdCollection</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>RequiredECCTypeIdCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Required_Credentials_to_Find_Current_ECC_Types.External_Contact_Credential_Type__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Required_Credentials_to_Find_Current_ECC_Types</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_External_Contact_Credential_to_Collection</name>
        <label>Assign External Contact Credential to Collection</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>ExternalContactCredentialRecords</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>ExternalContactCredential</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_RequiredECCTypeIdCollection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Values_to_External_Contact_Credential_Record</name>
        <label>Assign Values to External Contact Credential Record</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>ExternalContactCredential.Vendor__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>OnboardingRecord.Vendor__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ExternalContactCredential.POE_Contact__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>PrincipalOwnerId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ExternalContactCredential.External_Contact_Credential_Type__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_RequiredECCTypeIdCollection</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ExternalContactCredential.POE_Process_Status__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>New</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ExternalContactCredential.POE_Program__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Verizon Fios D2D</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ExternalContactCredential.Unique_Key__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>TargetKey</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Assign_External_Contact_Credential_to_Collection</targetReference>
        </connector>
    </assignments>
    <collectionProcessors>
        <name>Filter_External_Contact_Credential_Record_Collection</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Filter External Contact Credential Record Collection</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNextValueToReference>currentItem_Filter_External_Contact_Credential_Record_Collection</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>ExternalContactCredentialRecordCollectionInDB</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_Filter_External_Contact_Credential_Record_Collection.External_Contact_Credential_Type__c</leftValueReference>
            <operator>NotEqualTo</operator>
            <rightValue>
                <elementReference>Loop_RequiredECCTypeIdCollection</elementReference>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>Does_ECC_Record_Exist</targetReference>
        </connector>
    </collectionProcessors>
    <decisions>
        <name>Does_ECC_Record_Exist</name>
        <label>Does ECC Record Exist</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnector>
            <targetReference>Loop_RequiredECCTypeIdCollection</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>ECC Record Exists</defaultConnectorLabel>
        <rules>
            <name>No_ECC_Record_Does_Not_Exist</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Filter_External_Contact_Credential_Record_Collection</leftValueReference>
                <operator>IsEmpty</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Values_to_External_Contact_Credential_Record</targetReference>
            </connector>
            <label>No ECC Record Does Not Exist</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_ECC_Type_Required</name>
        <label>Is ECC Type Required</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnector>
            <targetReference>Loop_Required_Credentials_to_Find_Current_ECC_Types</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>ECC Type is Not Required</defaultConnectorLabel>
        <rules>
            <name>Yes_ECC_Type_is_Required</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Loop_Required_Credentials_to_Find_Current_ECC_Types.Is_Required__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_ECC_Credential_Type_to_RequireECCTypeIdCollection</targetReference>
            </connector>
            <label>Yes - ECC Type is Required</label>
        </rules>
    </decisions>
    <description>DOMAIN LAYER - Onboarding Object - Subflow - CREATE - External Contact Credentials</description>
    <environments>Default</environments>
    <formulas>
        <name>TargetKey</name>
        <dataType>String</dataType>
        <expression>{!PrincipalOwnerId}&amp; &apos;|&apos; &amp;{!OnboardingRecord.Vendor__c}&amp; &apos;|&apos; &amp;{!Loop_RequiredECCTypeIdCollection}</expression>
    </formulas>
    <interviewLabel>DOMAIN - Onboarding - SFL - CREATE - External Contact Credential {!$Flow.CurrentDateTime}</interviewLabel>
    <label>DOMAIN - Onboarding - SFL - CREATE - External Contact Credentials</label>
    <loops>
        <name>Loop_Required_Credentials_to_Find_Current_ECC_Types</name>
        <label>Loop Required Credentials to Find Current ECC Types</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <collectionReference>RequiredCredentialRecordCollection</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Is_ECC_Type_Required</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Get_External_Contact_Credentials</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_RequiredECCTypeIdCollection</name>
        <label>Loop RequiredECCTypeIdCollection</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <collectionReference>RequiredECCTypeIdCollection</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Filter_External_Contact_Credential_Record_Collection</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Create_External_Contact_Credential_Records</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_External_Contact_Credential_Records</name>
        <label>Create External Contact Credential Records</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Update_Contact_Record_s_Non_Chuzo_Program</targetReference>
        </connector>
        <inputReference>ExternalContactCredentialRecords</inputReference>
    </recordCreates>
    <recordLookups>
        <name>Get_External_Contact_Credential_Types</name>
        <label>Get External Contact Credential Types</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Required_Credentials_to_Find_Current_ECC_Types</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Vendor_Customization__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>OnboardingRecord.Vendor_Customization__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Active__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>External_Contact_Credential_Type__c</object>
        <outputReference>ExternalContactCredentalTypes</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Active__c</queriedFields>
        <queriedFields>Vendor_Customization__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_External_Contact_Credentials</name>
        <label>Get External Contact Credentials</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_RequiredECCTypeIdCollection</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>POE_Contact__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>PrincipalOwnerId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Vendor__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>OnboardingRecord.Vendor__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>External_Contact_Credential_Type__c</field>
            <operator>In</operator>
            <value>
                <elementReference>RequiredECCTypeIdCollection</elementReference>
            </value>
        </filters>
        <object>POE_External_Contact_Credential__c</object>
        <outputReference>ExternalContactCredentialRecordCollectionInDB</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>External_Contact_Credential_Type__c</queriedFields>
        <queriedFields>Unique_Key__c</queriedFields>
        <queriedFields>Vendor__c</queriedFields>
        <sortField>CreatedDate</sortField>
        <sortOrder>Asc</sortOrder>
    </recordLookups>
    <recordLookups>
        <name>Get_Required_Credentials</name>
        <label>Get Required Credentials</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_External_Contact_Credential_Types</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Vendor_Customization__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>OnboardingRecord.Vendor_Customization__c</elementReference>
            </value>
        </filters>
        <object>Required_Credential__c</object>
        <outputReference>RequiredCredentialRecordCollection</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Is_Required__c</queriedFields>
        <queriedFields>External_Contact_Credential_Type__c</queriedFields>
    </recordLookups>
    <recordUpdates>
        <name>Update_Contact_Record_s_Non_Chuzo_Program</name>
        <label>Update Contact Record&apos;s Non-Chuzo Program</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>PrincipalOwnerId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>POE_Commercial_Programs__c</field>
            <value>
                <stringValue>Verizon Fios D2D</stringValue>
            </value>
        </inputAssignments>
        <object>Contact</object>
    </recordUpdates>
    <runInMode>SystemModeWithoutSharing</runInMode>
    <start>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Required_Credentials</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <name>currentItem_Does_External_Contact_Credential_Already_Exist</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>POE_External_Contact_Credential__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Filter_External_Contact_Credential_Record_Collection</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>POE_External_Contact_Credential__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Filter_Required_Credential_Records_by_ECC_Type</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Required_Credential__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Find_Training_Assignments_that_Point_to_the_Training_Requirements</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Training_Assignment__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Keep_ECC_Types_for_which_No_ECC_Exists</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>POE_External_Contact_Credential__c</objectType>
    </variables>
    <variables>
        <name>currentItem_TR_for_Type_Collection</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Training_Requirement__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Training_Assignments_linked_to_those_Training_Requirements</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Training_Assignment__c</objectType>
    </variables>
    <variables>
        <name>ExternalContactCredentalTypes</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <objectType>External_Contact_Credential_Type__c</objectType>
    </variables>
    <variables>
        <name>ExternalContactCredential</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>POE_External_Contact_Credential__c</objectType>
    </variables>
    <variables>
        <name>ExternalContactCredentialRecordCollectionInDB</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>POE_External_Contact_Credential__c</objectType>
    </variables>
    <variables>
        <name>ExternalContactCredentialRecords</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <objectType>POE_External_Contact_Credential__c</objectType>
    </variables>
    <variables>
        <name>ExternalContactCredentialTypeRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <objectType>External_Contact_Credential_Type__c</objectType>
    </variables>
    <variables>
        <name>OnboardingRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>Onboarding__c</objectType>
    </variables>
    <variables>
        <name>PrincipalOwnerId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>RequiredCredentialRecordCollection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <objectType>Required_Credential__c</objectType>
    </variables>
    <variables>
        <name>RequiredECCTypeIdCollection</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
